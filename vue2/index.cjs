"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const l=require("@soei/util"),g=require("@soei/tools"),ht=require("@soei/picker");let at=/(\d+|[+\-\*/]|%)/g,I={"+":(t,e)=>t+e,"-":(t,e)=>t-e,"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e,i)=>parseFloat(t)/100*i},q=(t,e)=>{let i;if(i=l.runer("match",t,at)){let s=i.length,o,u=0,n,a=[];for(;s--;)u=i.shift(),u in I?(o&&a.push(o),u==="%"&&(a.length=2),n=u):+u&&a.push(+u),a.length==2&&(a.push(e),o=I[n].apply(null,a),a.length=0);+o||(o=+a.pop()),t=o>>0}return t},U={},b=(t,e)=>(t+"").replace(/\w+\((.*)\)/g,"$1").replace(U[e]||(U[e]=new RegExp("(?=\\s+|^)(\\d+)(?:\\.\\d{1,})?(?!(?:\\.)*\\d|%|\\w)","g")),"$1px");function E(t,e,i,s,o,u,n,a){var r=typeof t=="function"?t.options:t;e&&(r.render=e,r.staticRenderFns=i,r._compiled=!0),s&&(r.functional=!0),u&&(r._scopeId="data-v-"+u);var h;if(n?(h=function(c){c=c||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!c&&typeof __VUE_SSR_CONTEXT__<"u"&&(c=__VUE_SSR_CONTEXT__),o&&o.call(this,c),c&&c._registeredComponents&&c._registeredComponents.add(n)},r._ssrRegister=h):o&&(h=a?function(){o.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:o),h)if(r.functional){r._injectStyles=h;var d=r.render;r.render=function(f,_){return h.call(_),d(f,_)}}else{var p=r.beforeCreate;r.beforeCreate=p?[].concat(p,h):[h]}return{exports:t,options:r}}let X=t=>t==null||t==null,ut=(...t)=>{console.info("::::FLYWEIGHT",...t)};const ct={name:"Flyweight",props:{flys:{type:Array,default:()=>[]},width:{type:[String,Number],default:0},height:{type:[String,Number],default:100},w:{type:[Number,String]},h:{type:[Number,String]},offset:{type:Array,default:()=>[0,0]},lazy:{type:Number,default:100},view:{type:Object,default:()=>({id:0})},index:{type:Number,default:0},top:{type:[String,Number],default:0},left:{type:[String,Number],default:0},auto:{type:[Boolean,String],default:!1},space:{type:Object,default:()=>null},padding:{type:Boolean,default:!1}},computed:{flyweight(){return this.$refs.flyweight||""},style(){var t=this.w,e=this.h,i=this.Size,s={};return l.merge(s,{"--width":b(this.realW),"--height":b(this.realH),"--flyweight-content":b(i)},e&&{"--flyweight-h":b(e)},t&&s,{"--flyweight-w":b(t)},"mix"),s}},data(){return{flyweights:[],actice:!1,Size:null,column:1,row:1,expand:10,count:0,task:[],realW:0,realH:0}},watch:{flys(t){this.count=t.length,this.rebuild();let e=this.task.shift();e&&this.$nextTick(()=>{this.setview(e)})},view:{handler(t){this.setview(t)},immediate:!0,deep:!0},index(t){this.setindex(t)},top(t){this.flyweight.scrollTop=t},left(t){this.flyweight.scrollLeft=t}},mounted(){this.flyweights=[],this.$set||(this.$set=(t,e,i)=>{t[e]=i}),this.setindex(this.index);try{new ResizeObserver(()=>{this.rebuild(),this.$emit("resize")}).observe(this.flyweight)}catch(t){ut(t)}this.scrollx=l.runer("hasAttribute",this.flyweight,"scroll-x"),this.BoxRule="clientHeight=>height,clientWidth=>width",this.direction=this.scrollx?"scrollLeft":"scrollTop"},methods:{exec:b,trigger(t,e){l.isArray(t)||(t=t&&e?[[t,e]]:[]),t.length&&this.lazyrun(()=>{l.each(t,(i,s)=>{this.$emit(s[0],X(s[1])?!0:s[1])})})},cheackflys(t){if(!this.flys.length)return t&&this.task.push(t),!0},setview(t){l.runer([this.cheackflys,e=>{e=e||{};let i=e.index||l.each(this.flys,(s,o,u,n)=>{if(o[u]==n)return s},e.picker,e.id);X(i)||this.setindex(i)}],this,t)},setindex(t){l.runer([this.cheackflys,({index:e})=>{this.selectIndex=e,this.$nextTick(()=>{let i=e/this.column>>0,s=this.expand;(this.flyweight[this.direction]/s>>0)+this.row-i-1>0||(this.flyweight[this.direction]=i*s,this.scroll())})}],this,{index:t})},lazyrun(t,e){clearTimeout(this.time),this.time=setTimeout(()=>{l.runer(t)},e||this.lazy)},run(t){let e=[],i=l.runer(this.direction,t.target),s={offset:i,top:i,width:this.realW,height:this.realH,index:i/this.expand>>0};l.merge(s,this.space),t.from||e.push(["onscroll",s]);let o=!1;l.each(this.flyweights,(u,n,a,r,h,d,p,c,f)=>{if(a=u/h>>0,c=a+r*(+(a<d%r)+(d/r>>0)),f=c*h+u%h,f>=this.count){o||(e.push(["onend"]),o=!0);return}n.index=c,n.i=f,n.data=this.flys[f];let _=[c*this.expand+n.x,n.space];p&&_.reverse(),n.top=_[0],n.left=_[1]},null,this.row,this.column,s.index,this.scrollx),this.trigger(e),e=null},scroll(t){this.run(t||{target:this.flyweight,from:"space"})},rebuild(){let t=this.count||this.flys.length,e=this.flyweights;if(!t)return e.length=t;this.count=t;let i=this.scrollx,s=this.flyweight,o=l.picker(s,this.BoxRule);this.$nextTick(()=>{let u=/true/.test(this.auto),[n,a]=this.offset,r=o.width,h=o.height,d=(q(this.width,r)||r)+n,p=q(this.height,h)+a,c=[r/d>>0||1,h/p>>0||1];i&&c.reverse();let[f,_]=c,x=this.padding,C,S=0,y,v;i?(y=d,d-=n,v=$=>$*(p-a)+($+1)*a):(u?(d=(r-n*(f+2*x-1))/f,C=!x*n,S=x*n):(C=0,S=(r%d+n*f)/(f+1)>>0,d-=n),v=$=>$*(d+C)+($+1)*S,y=p),this.row=_+2,this.column=f,this.realH=p-a,this.realW=d,this.expand=y,this.Size=Math.ceil(t/f)*y;let w=Math.min(t,f*this.row),m=w-1,T;for(;w-- >0;)T=m-w,this.$set(e,T,{x:n,y:a,width:d,height:p-a,space:v(T%f),data:{}});e.length=m+1;let z=[];h/y>m/f&&z.push(["onend"]),this.flyweight&&(this.flyweight[this.direction]=0),this.$nextTick(()=>{this.setindex(this.selectIndex||0),this.scroll()}),z.push(["update:space",{row:(m/f>>0)+1,column:f,showrow:this.row,showcolumn:this.column}]),this.trigger(z)})}}};var ft=function(){var e=this,i=e._self._c;return i("div",{ref:"flyweight",staticClass:"flyweight",class:{"flyweight-active":e.actice},style:e.style,on:{scroll:e.scroll}},[i("div",{staticClass:"flyweight-all"},e._l(e.flyweights,function(s,o){return i("div",{key:o,style:{top:s.top+"px",left:s.left+"px"}},[e._t("default",null,null,s)],2)}),0),e.flyweights.length?e._t("end"):e._e()],2)},dt=[],pt=E(ct,ft,dt,!1,null,"d5f1cd63",null,null);const K=pt.exports;function W(t,e){return e&&(t=t.replace(/[a-z]/g,"")),t.toLowerCase()}let Q={close:{handler(t){this.change(t)},deep:!0},offset:{handler(t){this.margin(t)},deep:!0}},gt=["BackGround","BordeR","Height","Width","Top","Right","Bottom","Left"],Z={};l.each(gt,(t,e,i)=>{t=W(e),Z["--"+W(e,!0)]=t,i[t]=function(){this.trigger++}},Q);const _t={name:"Card",props:{offset:{type:[String,Array],default:()=>[0,0,0,0]},background:{type:String,default:""},border:{type:String,default:"1px"},height:{type:String,default:"100%"},width:{type:String,default:"100%"},show:{type:String,default:""},close:{type:Object,default:null},title:{type:String,default:""}},data(){return{closecss:{},trigger:0,default:{top:"0px",right:"0px",bottom:"0px",left:"0px",height:"100%",width:"100%",background:"",border:"1px"}}},computed:{style(){return this.tr()}},watch:Q,methods:{exec:b,isEmpty:l.isEmpty,isSimplyType:l.isSimplyType,tr(){let t={};return this.margin(this.offset),l.each(Z,(e,i)=>{this.css(t,e,i)}),t},tolower:W,css(t,e,i){let s=this[i]||this.default[i];!s||this.default[i]==s||(t[e]=b(s))},change(t){l.isSimplyType(t)||(this.closecss=l.picker(t,"color=>--s-card-close-color,size=>--s-close-width,bold=>--s-close-height,*"))},margin(t){l.merge(this,l.picker(l.isString(t)?t.split(/\s*(?:,|\s+)\s*/):t,"0=>top,1|0=>right,2|0=>bottom,3|1|0=>left",!0),!0)}},mounted(){this.change(this.close)}};var yt=function(){var e=this,i=e._self._c;return i("div",{key:e.trigger,staticClass:"card",style:e.isEmpty(e.style)?e.tr():e.style},[e._t("default",function(){return[e._t("title",function(){var s;return[i("div",{staticClass:"card-title"},[e._v(" "+e._s(e.show||e.title)+" "),i("div",{staticClass:"card-close",class:{hide:e.isSimplyType(e.close)?!e.close:!1},style:e.closecss,attrs:{title:(s=e.close)==null?void 0:s.tips},on:{click:function(o){return e.$emit("close")}}})])]}),e._t("content",function(){return[i("div",{staticClass:"card-content"},[e._t("inner")],2)]})]})],2)},mt=[],vt=E(_t,yt,mt,!1,null,"17093fb8",null,null);const tt=vt.exports,wt={name:"Stream",computed:{component(){return this.$refs.component},column(){let{columns:t,T:e}=this,i=t||e;return l.isEmpty(i)?[]:l.isArray(i)?i:[i]}},props:{bridge:{type:String,default:"slot"},type:{type:String,default:"div"},columns:{type:[Object,Array],default:()=>null},T:{type:[Array,Object],default:()=>null}},mounted(){this.$.vnode.ref&&l.merge(this,{...this.component})},methods:{__trigger(t){let e=t[this.bridge]||t.type;return(this.$slots||this.$scopedSlots)[e]?e:"default"}}};var bt=function(){var e=this,i=e._self._c;return i(e.type,e._b({ref:"component",tag:"component"},"component",e.$attrs,!1),[e._l(e.column,function(s){return e._t(e.__trigger(s),null,null,s)})],2)},xt=[],St=E(wt,bt,xt,!1,null,null,null,null);const et=St.exports,D=/(?:\,|\|{2})/,G="px",V="";let it=document.documentElement,Y,J=["s-left","s-top","s-right","s-bottom"],$t={left:0,top:1,right:2,bottom:3};const O=[];var Tt=ht(window,"Reflect.defineProperty|Object.defineProperty=>Proxy").Proxy;let A={},st=null;Tt(A,"delay",{get(){return this._delay},set(t){st=zt(()=>{g.runer(O)},t),this._delay=t}});A.delay=60;function zt(t,e){let i=0;return function(){const s=Date.now();s-i>=e&&(i=s,g.runer(t,this,arguments))}}const M=()=>{st()};function Ct(t){O.push(t)}const k=new ResizeObserver(M);k.observe(it);function rt(t){t.onresize||(O.push([rt,null,t]),t.onresize=!0);var e=it,i=e.clientHeight,s=g.isNil(t.offset)?15:t.offset,o=t.target,u=t.room,n=t.index,a=t.position,r=o.getBoundingClientRect(),h=u.offsetHeight+s,d=u.offsetWidth+s,p="3,0,2,1".split(D),c,f=(r.height==Y?r.bottom-r.top:r.height)>>0,_=(r.width==Y?r.right-r.left:r.width)>>0,x=e.clientWidth-d,C=i-h,S=[r.left-d,r.top-h,x-r.right,C-r.bottom];a&&(g.each(a.split(D),function(lt,R,H,ot){ot.push(H[R])},$t,c=[]),p.unshift.apply(p,c)),n=g.each(p,function(lt,R,H){if(H[R]>0)return R},S);var y=0,v=0,w=0;if(n!=null){var m=n==0||n==2,T=n==3||n==1;y=T?Math.min(r.left,x):n==2?r.right+s:S[0],h-=s*+m;var z=Math.max(r.top,0),$=Math.min(r.bottom,i),F=($-h+Math.min(i-h,z))/2;v=Math.max(m?F:n==3?r.top+f+s:Math.min(F,S[1]),0),T&&r.left>x&&(w=r.left-y-s+_/2)}let P=u.classList,N=t.css;P.remove(...J),P.add(J[n]),t.index=n,N.left=y+G,N.top=v+G;let B=N["--tips-arrow-top"]=m?Math.min(Math.max(v,z)-v,h-s):V,j=d-3*s;N["--tips-arrow"]=w>j-10||m&&(B+(h>50?15:0)>h||!B)?"hidden":"visible",N["--tips-arrow-left"]=w?Math.min(w,j):V}const L="data-tips-scroll",Nt={name:"Tips",props:{visible:{type:[Boolean,String,Number],default:!0},content:{type:String,default:""},title:{type:[String,Number],default:""},position:{type:String,default:"top"},offset:{type:[String,Number],default:void 0},fontSize:{type:[String,Number],default:void 0},border:{type:[String,Number],default:void 0},color:{type:[String,Number],default:void 0},background:{type:[String,Number],default:void 0},static:{type:Boolean,default:!1},delay:{type:[String,Number],default:10},borderRadius:{type:[String,Number],default:10}},watch:{visible:function(t){t&&this.$nextTick(()=>{this.init()})}},data(){return{css:{}}},methods:{parent(t){let e=this.$el,i;for(;e&&(e=e.parentNode,e&&e.nodeType==1||(e=window,i=!0),g.runer(t,null,e,i),!i););},attr(t,e,i){return g.runer(t[i===void 0?"getAttribute":"setAttribute"],t,e,i)},init(){this.$el.nodeName!="#comment"&&rt({onresize:!1,target:this.$el.parentNode,room:this.$el,position:this.position,css:this.css,offset:+this.offset>>0})},scrollListener(){this.static||this.parent((t,e,i)=>{e?g.runer(t.addEventListener,t,"scroll",M):(g.runer(k.observe,k,t),(t.offsetHeight<t.scrollHeight||t.offsetWidth<t.scrollWidth)&&(i=this.attr(t,L),i||(g.runer(t.addEventListener,t,"scroll",M),this.attr(t,L,"true"))))})}},mounted(){l.merge(this.css,l.picker(this.$props,"color=>--tips-color,background=>--tips-background-color,border=>--tips-border-width,fontSize=>--tips-font-size,borderRadius=>--tips-border-radius")),this.css["--arrow-size"]=Math.sqrt(2*Math.pow((this.border||3)*2+2,2))/2>>0,this.init(),A.delay=+this.delay,Ct(t=>{this.scrollListener()}),this.scrollListener()},unmounted(){this.parent(function(t,e){g.runer(t.removeEventListener,t,"scroll",M),g.runer(t.removeAttribute,t,L,void 0),e||g.runer(k.unobserve,k,t)})}};var kt=function(){var e=this,i=e._self._c;return e.visible?i("div",e._b({staticClass:"tips",style:e.static?null:e.css,attrs:{static:e.static?"":null}},"div",e.$attrs,!1),[e._t("default",function(){return[e._t("title",function(){return[i("div",{staticClass:"tips-title"},[e._v(e._s(e.title))])]}),e._t("content",function(){return[e._v(e._s(e.content))]})]})],2):e._e()},Rt=[],Mt=E(Nt,kt,Rt,!1,null,"d4e2f8f1",null,null);const nt=Mt.exports,Et=[K,tt,et,nt],Ht={install(t){Et.forEach(e=>{t.component("S"+e.name,e),t.component(e.name+"S",e)})}};exports.Card=tt;exports.Flyweight=K;exports.Stream=et;exports.Tips=nt;exports.default=Ht;
