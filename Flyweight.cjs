"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const n=require("@soei/util"),l=require("vue");let H=/(\d+|[+\-\*/]|%)/g,T={"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t,s)=>parseFloat(e)/100*s},v=(e,t)=>{let s;if(s=n.runer("match",e,H)){let h=s.length,r,i=0,c,o=[];for(;h--;)i=s.shift(),i in T?(r&&o.push(r),i==="%"&&(o.length=2),c=i):+i&&o.push(+i),o.length==2&&(o.push(t),console.log(o,c,"W"),r=T[c].apply(null,o),o.length=0);+r||(r=+o.pop()),e=r>>0}return e},z=e=>e.replace(/\w+\((.*)\)/g,"$1").replace(/(?=\D)0(?!\w)/,"0px");const B=(e,t)=>{const s=e.__vccOpts||e;for(const[h,r]of t)s[h]=r;return s};let $=e=>e==null||e==null,C=(...e)=>{console.info("::::FLYWEIGHT",...e)};const O={name:"Flyweight",props:{flys:{type:Array,default:()=>[]},width:{type:Number,default:0},height:{type:Number,default:100},offset:{type:Array,default:()=>[0,0]},lazy:{type:Number,default:100},view:{type:Object,default:()=>({id:0})},index:{type:Number,default:0},top:{type:Number,default:!1},left:{type:Number,default:!1},auto:{type:[Boolean,String],default:!1},space:{type:Object,default:()=>null},padding:{type:Boolean,default:!1}},computed:{flyweight(){return this.$refs.flyweight}},data(){return{flyweights:[],actice:!1,Height:null,column:1,row:1,fwheight:10,count:0,task:[],realW:0,realH:0}},watch:{flys(e){this.count=e.length,this.re();let t=this.task.shift();t&&this.$nextTick(()=>{this.setview(t)})},view:{handler(e){this.setview(e)},immediate:!0,deep:!0},index(e){this.setindex(e)},top(e){this.flyweight.scrollTop=e},left(e){this.flyweight.scrollLeft=e}},mounted(){this.flyweights=[],this.$set||(this.$set=(e,t,s)=>{e[t]=s}),this.setindex(this.index);try{new ResizeObserver(()=>{this.re(),this.$emit("resize")}).observe(this.flyweight)}catch(e){C(e)}},methods:{trigger(e,t){this.lazyrun(()=>{n.isArray(e)||(e=[[e,t]]),n.each(e,(s,h)=>{this.$emit(h[0],$(h[1])?!0:h[1])})})},cheackflys(e){if(!this.flys.length)return e&&this.task.push(e),!0},setview(e){n.runer([this.cheackflys,t=>{t=t||{};let s=t.index||n.each(this.flys,(h,r,i,c)=>{if(r[i]==c)return h},t.picker,t.id);$(s)||this.setindex(s)}],this,e)},setindex(e){n.runer([this.cheackflys,({index:t})=>{this.$nextTick(()=>{let s=t/this.column>>0,h=this.fwheight;(this.flyweight.scrollTop/h>>0)+this.row-s-1>0||(this.flyweight.scrollTop=s*h,this.scroll())})}],this,{index:e})},lazyrun(e,t){clearTimeout(this.time),this.time=setTimeout(()=>{n.runer(e)},t||this.lazy)},run(e){let t=[],s=n.picker(e.target,"scrollTop=>top");n.merge(s,{height:this.realH,width:this.realW,index:s.top/this.fwheight>>0},this.space,"mix"),e.from||t.push(["onscroll",s]);let h=!1;n.each(this.flyweights,(r,i,c,o,d,u,f,a)=>{if(c=r/d>>0,f=c+o*(+(c<u%o)+(u/o>>0)),a=f*d+r%d,a>=this.count){h||(t.push(["onend"]),h=!0);return}i.index=f,i.i=a,i.top=f*this.fwheight,i.data=this.flys[a],i.width=this.realW,i.height=this.realH},null,this.row,this.column,s.index),this.trigger(t),t=null},scroll(e){this.run(e||{target:this.flyweight,from:"space"})},re(){let e=this.count||this.flys.length,t=this.flyweights;if(!e)return t.length=e;this.count=e;let s=this.flyweight,h=n.picker(s,"clientHeight=>height,clientWidth=>width");this.$nextTick(()=>{let r=/true/.test(this.auto),[i,c]=this.offset,o=h.width,d=h.height,u=(v(this.width,o)||o)+i,f=v(this.height,d)+c;this.realH=f-c;let a=o/u>>0||1,g=d/f>>0,m=this.padding;this.row=g+2,this.column=a,this.fwheight=f;let w,_=0;r?(u=(o-i*(a+2*m-1))/a,w=!m*i,_=m*i):(w=0,_=(o%u+i*a)/(a+1)>>0,u-=i),this.realW=u,this.Height=Math.ceil(e/a)*f;let S=Math.min(e,a*this.row),y=S-1,p,k,b;for(;S-- >0;)p=y-S,b=this.flys[p],s=t[p],g=p/a>>0,k=p%a,this.$set(t,p,{data:b,top:g*f,left:k*(u+w)+(k+1)*_,index:g});t.length=y+1;let x=[];d/f>y/a&&x.push(["onend"]),this.scroll(),x.push(["update:space",{row:(y/a>>0)+1,column:a,showrow:this.row,showcolumn:this.column}]),this.trigger(x)})}}};function W(e,t,s,h,r,i){return l.openBlock(),l.createElementBlock("div",{ref:"flyweight",class:l.normalizeClass(["flyweight",{"flyweight-active":r.actice}]),style:l.normalizeStyle({"--width":r.realW+"px","--height":r.realH+"px"}),onScroll:t[0]||(t[0]=(...c)=>i.scroll&&i.scroll(...c))},[l.createElementVNode("div",{class:"flyweight-all",style:l.normalizeStyle({"--flyweight-height":r.Height+"px"})},[(l.openBlock(!0),l.createElementBlock(l.Fragment,null,l.renderList(r.flyweights,(c,o)=>(l.openBlock(),l.createElementBlock("div",{key:o,style:l.normalizeStyle({top:c.top+"px",left:c.left+"px"})},[l.renderSlot(e.$slots,"default",l.mergeProps({ref_for:!0},c),void 0,!0)],4))),128))],4),r.flyweights.length?l.renderSlot(e.$slots,"end",{key:0},void 0,!0):l.createCommentVNode("",!0)],38)}const N=B(O,[["render",W],["__scopeId","data-v-4f09502c"]]);const F={name:"Card",props:{offset:{type:[String,Array],default:()=>[0,0,0,0]},background:{type:String,default:""},border:{type:String,default:"1px"},height:{type:String,default:"100%"},width:{type:String,default:"100%"},show:{type:String,default:""},close:{type:Object,default:null},title:{type:String,default:""}},data(){return{closecss:{},$$attrs:{},top:"0",right:"0",bottom:"0",left:"0",style:{}}},computed:{style(){let e={};return n.each(["BackGround","Border","Height","Width","Top","Right","BottoM","Left"],(t,s)=>{e["--"+s.replace(/[a-z]/g,"")]=z(this[s.toLowerCase()])}),e}},watch:{close:{handler(e){this.change(e)},deep:!0},offset:{handler(e){this.offser(e)},deep:!0}},methods:{exec:z,isEmpty:n.isEmpty,isSimplyType:n.isSimplyType,change(e){n.isSimplyType(e)||(this.closecss=n.picker(e,"color=>--s-card-close-color,*"))},offser(e){e=n.isString(e)?e.split(/\s*(?:,|\s+)\s*/):e;let t=n.picker(e,"0=>top,1|0=>right,2|0=>bottom,3|1|0=>left",!0);n.each(t,(s,h,r)=>{r[s]=h+"px"},t),n.merge(this,t,!0)}},mounted(){this.change(this.close),this.offser(this.offset)}},L={class:"card-title"},V={class:"card-content"};function M(e,t,s,h,r,i){return l.openBlock(),l.createElementBlock("div",{class:"card",style:l.normalizeStyle(i.style)},[l.renderSlot(e.$slots,"default",{},()=>[l.renderSlot(e.$slots,"title",{},()=>[l.createElementVNode("div",L,[l.createTextVNode(l.toDisplayString(s.show||s.title)+" ",1),l.createElementVNode("div",{class:l.normalizeClass(["card-close",{hide:i.isSimplyType(s.close)?!s.close:!1}]),style:l.normalizeStyle(r.closecss),onClick:t[0]||(t[0]=c=>e.$emit("close"))},null,6)])],!0),l.renderSlot(e.$slots,"content",{},()=>[l.createElementVNode("div",V,[l.renderSlot(e.$slots,"inner",{},void 0,!0)])],!0)],!0)],4)}const E=B(F,[["render",M],["__scopeId","data-v-ca61ca3d"]]),j=[N,E],I={install(e){j.forEach(t=>{e.component("S"+t.name,t),e.component(t.name+"S",t)})}};exports.Card=E;exports.Flyweight=N;exports.default=I;
